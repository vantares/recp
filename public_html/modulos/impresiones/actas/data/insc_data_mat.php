<?php
$pdf->SetAutoPageBreak(false, 10);
//$pdf->SetTopMargin(50);
$pdf->AddPage();
$pdf->SetTopMargin(0);
$pdf->SetFont('Arial','',12);
$ini_y=7;
$ini_x=4;

//$data = new inscripcionTable();
//$data->readEnv();

#INSCRIPCIONES DE DEFUNCION
if ($data->request['idinscripcion']) {
	$rows = $data->readDataSQL("SELECT m.*, aj.*, ins.*, ac.idtomo, ac.folio, ac.partida, t.numero FROM matrimonio m INNER JOIN actojuridico aj ON m.idmatrimonio=aj.idactojuridico INNER JOIN inscripcion ins ON aj.idactojuridico= ins.idinscripcion LEFT JOIN acta ac ON ac.idinscripcion= ins.idinscripcion INNER JOIN tomo t on t.idtomo=ac.idtomo WHERE ac.idinscripcion='" . $data->request['idinscripcion'] ."'");
	/*
	 * consultando las modificaciones (marginaciones)
	 */
	$notasmarginales= $data->readDataSQL("SELECT cuerpo FROM notamarginal WHERE idinscripcion=" . $data->request['idinscripcion']." ORDER BY fechamarginacion DESC LIMIT 3");
        $row = $rows[0];
     	# $pdf->Image('./imgs/acta_matrimonio_frente.png', 32,10, 226.23,315.98 );
     	//$pdf->Image('./imgs/acta_matrimonio_frente.jpg', 32,10, 226.23,315.98 );
	$pdf->SetY($ini_y + 31);
	$pdf->SetX($ini_x + 117);
	$pdf->Cell(0,0,strtoupper('Matagalpa'));
	$pdf->SetY($ini_y + 18);
	$pdf->SetX($ini_x + 237);
	$pdf->Cell(0,0,$row['numero']);
	$pdf->SetY($ini_y + 25);
	$pdf->SetX($ini_x + 237);
	$pdf->Cell(0,0,$row['folio']);
	$pdf->SetY($ini_y + 31);
	$pdf->SetX($ini_x + 241);
	$pdf->Cell(0,0,$row['partida']);
	$pdf->SetY($ini_y + 37);
	$pdf->SetX($ini_x + 237);
	$fecha_acta= new Datetime($row['fecha']);
	$pdf->Cell(0,0,$fecha_acta->format('d/m/Y'));
	$pdf->SetY($ini_y + 57);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['inscrito1nombre1']));
	$pdf->SetY($ini_y + 57);
	$pdf->SetX($ini_x + 95);
	$pdf->Cell(0,0,strtoupper($row['inscrito1nombre2']));
	$pdf->SetY($ini_y + 57);
	$pdf->SetX($ini_x + 160);
	$pdf->Cell(0,0,strtoupper($row['inscrito1apellido1']));
	$pdf->SetY($ini_y + 57);
	$pdf->SetX($ini_x + 227);
	$pdf->Cell(0,0,strtoupper($row['inscrito1apellido2']));
	$pdf->SetY($ini_y + 76);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['inscrito2nombre1']));
	$pdf->SetY($ini_y + 76);
	$pdf->SetX($ini_x + 95);
	$pdf->Cell(0,0,strtoupper($row['inscrito2nombre2']));
	$pdf->SetY($ini_y + 76);
	$pdf->SetX($ini_x + 160);
	$pdf->Cell(0,0,strtoupper($row['inscrito2apellido1']));
	$pdf->SetY($ini_y + 76);
	$pdf->SetX($ini_x + 227);
	$pdf->Cell(0,0,strtoupper($row['inscrito2apellido2']));
	$pdf->SetY($ini_y + 87);
	$pdf->SetX($ini_x + 42);
	$pdf->Cell(0,0,strtoupper($row['ciudadinscripcion']));
	$pdf->SetY($ini_y + 87);
	$pdf->SetX($ini_x + 167);
	$pdf->Cell(0,0,strtoupper($row['municipioinscripcion']));
	$pdf->SetY($ini_y + 94);
	$pdf->SetX($ini_x + 72);
	$pdf->Cell(0,0,strtoupper($row['departamentoinscripcion']));
	$pdf->SetY($ini_y + 94);
	$pdf->SetX($ini_x + 125);
	$fecha_inscripcion= new DateTime($row['fecha']);
	$fecha_inscripcion_parts= getdate($fecha_inscripcion->getTimestamp());
	$prt_fecha_inscripcion=number2str($fecha_inscripcion->format('g'));
	$prt_fecha_inscripcion.=" CON ". number2str($fecha_inscripcion_parts['minutes']);
	$pdf->Cell(0,0,$prt_fecha_inscripcion);
	$pdf->SetY($ini_y + 94);
	$pdf->SetX($ini_x + 207);
	$pdf->Cell(0,0,utf8_decode(($fecha_inscripcion_parts['hours']>12)?'TARDE':'MAÑANA'));
	//$pdf->Cell(0,0,'Turno');
	$pdf->SetY($ini_y + 100);
	$pdf->SetX($ini_x + 50);
	$prt_dia_inscripcion= number2str($fecha_inscripcion_parts['mday']);
	$pdf->Cell(0,0,$prt_dia_inscripcion);
	//$pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 100);
	$pdf->SetX($ini_x + 130);
	$pdf->Cell(0,0,strtoupper(strftime('%B',$fecha_inscripcion->getTimestamp())));
	//$pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 100);
	$pdf->SetX($ini_x + 212);
	$pdf->Cell(0,0,number2str($fecha_inscripcion->format('y')));
	//$pdf->Cell(0,0,date($row['fechadictament']));
	$pdf->SetY($ini_y + 114);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['compareciente1nombre']));
	$pdf->SetY($ini_y + 114);
	$pdf->SetX($ini_x + 180);
	$pdf->Cell(0,0,number2str($row['compareciente1edad']));
	$pdf->SetY($ini_y + 127);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['compareciente1oficio']));
	$pdf->SetX($ini_x + 90);
	$pdf->Cell(0,0,strtoupper($row['conyuge1estadocivilanterior']));

	$pdf->SetX($ini_x + 138);
	//NOTA: ellos remplzan esto por matagalpa
	$pdf->Cell(0,0,strtoupper('matagalpa'));
	/* $pdf->SetFont('Arial','',8);
	$pdf->MultiCell(75,3.0,strtoupper($row['compareciente1domicilio']));
	$pdf->SetFont('Arial','',12); */
	$pdf->SetX($ini_x + 223);
	$pdf->Cell(0,0,strtoupper($row['compareciente1cedula']));
	$pdf->SetY($ini_y + 148);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['jueznotario']));
	$pdf->SetY($ini_y + 157);
	//$pdf->SetY($ini_y + 160);
	$pdf->SetX($ini_x + 47);
	$fecha_dictamen= new DateTime($row['fechadictament']);
	$fecha_dictamen_parts= getdate($fecha_dictamen->getTimestamp());
	$prt_hora_dictamen=number2str($fecha_dictamen->format('g'));
	$prt_hora_dictamen.=" CON ". number2str($fecha_dictamen_parts['minutes'])." MINUTOS";
	$pdf->Cell(0,0,$prt_hora_dictamen);
	// $pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 157);
	//$pdf->SetY($ini_y + 160);
	$pdf->SetX($ini_x + 120);
	$pdf->Cell(0,0,utf8_decode(($fecha_dictamen_parts['hours']>12)?'TARDE':'MAÑANA'));
	//$pdf->Cell(0,0,'turno');
	$pdf->SetY($ini_y + 157);
	//$pdf->SetY($ini_y + 160);
	$pdf->SetX($ini_x + 210);
	$prt_dia_dictamen= number2str($fecha_dictamen_parts['mday']);
	$pdf->Cell(0,0,$prt_dia_dictamen);
	//$pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 163);
	//$pdf->SetY($ini_y + 166);
	$pdf->SetX($ini_x + 57);
	$pdf->Cell(0,0,strtoupper(strftime('%B',$fecha_dictamen->getTimestamp())));
	//$pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 163);
	//$pdf->SetY($ini_y + 166);
	$pdf->SetX($ini_x + 138);
	$pdf->Cell(0,0,number2str($fecha_dictamen->format('y')));
	//$pdf->Cell(0,0,$row['fechadictament']);
	$pdf->SetY($ini_y + 175);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge1nombre']));
	$pdf->SetY($ini_y + 175);
	$pdf->SetX($ini_x + 177);
	$pdf->Cell(0,0,number2str($row['conyuge1edad']));
	$pdf->SetY($ini_y + 191);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge1oficio']));
	$pdf->SetY($ini_y + 191);
	$pdf->SetX($ini_x + 133);
	$pdf->Cell(0,0,strtoupper($row['conyuge1estadocivilanterior']));
	$pdf->SetY($ini_y + 191);
	$pdf->SetX($ini_x + 192);
	$pdf->Cell(0,0,strtoupper($row['conyuge1nacionalidad']));
	$pdf->SetY($ini_y + 207);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge1domicilio']));
	$pdf->SetY($ini_y + 207);
	$pdf->SetX($ini_x + 210);
	$pdf->Cell(0,0,strtoupper($row['conyuge1cedula']));
	$pdf->SetY($ini_y + 222);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge2nombre']));
	$pdf->SetY($ini_y + 222);
	$pdf->SetX($ini_x + 177);
	$pdf->Cell(0,0,number2str($row['conyuge2edad']));
	$pdf->SetY($ini_y + 236);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge2oficio']));
	$pdf->SetY($ini_y + 236);
	$pdf->SetX($ini_x + 133);
	$pdf->Cell(0,0,strtoupper($row['conyuge2estadocivilanterior']));
	$pdf->SetY($ini_y + 236);
	$pdf->SetX($ini_x + 192);
	$pdf->Cell(0,0,strtoupper($row['conyuge2nacionalidad']));
	$pdf->SetY($ini_y + 250);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['conyuge2domicilio']));
	$pdf->SetY($ini_y + 250);
	$pdf->SetX($ini_x + 210);
	$pdf->Cell(0,0,strtoupper($row['conyuge2cedula']));
	$pdf->SetY($ini_y + 274);
	//$pdf->SetY($ini_y + 276);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['testigo1nombre']));
	$pdf->SetX($ini_x + 177);
	$pdf->Cell(0,0,number2str($row['testigo1edad']));
	$pdf->SetY($ini_y + 286);
	//$pdf->SetY($ini_y + 290);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['testigo1oficio']));
	$pdf->SetX($ini_x + 87);
	$pdf->Cell(0,0,strtoupper($row['testigo1estadocivil']));

	//$pdf->SetY($ini_y + 287);
	$pdf->SetX($ini_x + 140);
	//NOTE: no utiizan too el dato soo lo establece en MATAGALPA
	//$pdf->SetFont('Arial','',8);
	/* $pdf->MultiCell(75,3.0,strtoupper($row['testigo1domicilio']));
	$pdf->SetFont('Arial','',12); */
	$pdf->Cell(0,0,strtoupper('MATAGALPA'));
	$pdf->SetX($ini_x + 222);
	$pdf->Cell(0,0,strtoupper($row['testigo1cedula']));
	$pdf->SetY($ini_y + 302);
	//$pdf->SetY($ini_y + 304);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['testigo2nombre']));
	$pdf->SetX($ini_x + 210);
	$pdf->Cell(0,0,number2str($row['testigo2edad']));
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,strtoupper($row['testigo2oficio']));
	$pdf->SetY($ini_y + 316);
	//$pdf->SetY($ini_y + 318);
	$pdf->SetX($ini_x + 90);
	$pdf->Cell(0,0,strtoupper($row['testigo2estadocivil']));

	//$pdf->SetY($ini_y + 316);
	$pdf->SetX($ini_x + 136);
	$testigo2domicilio = $row['testigo2domicilio'];
	/* $pdf->SetFont('Arial','',8);
	$pdf->MultiCell(75,3.0,strtoupper($testigo2domicilio));
	$pdf->SetFont('Arial','',12); */
	$pdf->Cell(0,0,strtoupper('MATAGALPA'));
	$pdf->SetX($ini_x + 222);
	$pdf->Cell(0,0,strtoupper($row['testigo2cedula']));
	#pagina de atras
	$pdf->AddPage();
	$ini_y=-2;
	$ini_x=4;
	# $pdf->Image('./imgs/acta_matrimonio_atras.png', 29,15, 226.23,315.98);
	//$pdf->Image('./imgs/acta_matrimonio_atras.jpg', 29,15, 226.23,315.98);
	//$pdf->SetY($ini_y + 33);
	$pdf->SetY($ini_y + 34);
	$pdf->SetX($ini_x + 30);

	$reconocer_hijos= "";
	//$reconocer_hijos= $row['reconocer_hijos'];
	//$reconocer_hijos.= "nombre_hijo";
	$reconocimiento= new reconocimientoTable();
	$reconocidos= $reconocimiento->readDataFilter("reconocimiento.idinscripcion=".$row['idinscripcion']);
	if(sizeof($reconocidos)>0){
		$cell_h= 5;
		foreach($reconocidos as $hijo){
			$pdf->SetX($ini_x + 30);
			$fecha_nac= new DateTime($hijo['fechanacimiento']);
			$pdf->Cell(90,$cell_h,strtoupper($hijo['nombrereconocido']),0,0);
			$pdf->Cell(80,$cell_h,$fecha_nac->format('d/m/Y'),0,0);
			$pdf->Cell(58,$cell_h,strtoupper($hijo['lugarnacimiento']),0,0);
			$pdf->Ln();
			$pdf->Cell(228,1.5,"",0,0);
			$pdf->Ln();
		}
	}
	//$pdf->MultiCell(228,5.5,$reconocer_hijos);
	$pdf->SetY($ini_y + 141);
	//$pdf->SetY($ini_y + 143);
	$pdf->SetX($ini_x + 30);
	$matrimonio_extranjero= "                                               ";
	$matrimonio_extranjero.=strtoupper($row['enextranjero']);
	$pdf->MultiCell(228,5.5,$matrimonio_extranjero);
	$pdf->SetY($ini_y + 163);
	$pdf->SetX($ini_x + 30);
	$adicionales= "                              ";
	$adicionales.= strtoupper($row['datosadicionales']);
	$pdf->MultiCell(228,5.5,$adicionales);
	$pdf->SetY($ini_y + 183);
	$pdf->SetX($ini_x + 30);
	$observaciones=  "                         ";
	$observaciones.= strtoupper($row['observaciones']);
	$pdf->MultiCell(228,5.5,$observaciones);
	$pdf->SetY($ini_y + 218);
	$pdf->SetX($ini_x + 30);
	# $mod_civil= 'aqui las modificaciones al estado civil';
	# $mod_civil= iconv("iso-8859-9","utf-8",$notasmarginales[0]['cuerpo']);
	foreach($notasmarginales as $notamarginal){
		$modificaciones[]= strtoupper($notamarginal['cuerpo']);
	}
	$mod_civil="                                                    ";
	$mod_civil.= utf8_decode(implode(PHP_EOL,$modificaciones));
	$pdf->MultiCell(228,5.5,$mod_civil);
	$pdf->SetY($ini_y + 290);
	//$pdf->SetY($ini_y + 284);
	$pdf->SetX($ini_x + 35);
	$pdf->Cell(0,0,$row['nombreregistrador']);
	$pdf->SetX($ini_x + 168);
	$pdf->Cell(0,0,$row['nombresecretario']);
	$c1_vc= 314;
	$pdf->SetY($ini_y + $c1_vc);
	$pdf->SetX($ini_x + 50);
	$pdf->Cell(0,0,$row['conyuge1lugarinscripcion']);
	$pdf->SetY($ini_y + $c1_vc);
	$pdf->SetX($ini_x + 130);
	$pdf->Cell(0,0,$row['conyuge1tomoinscripcion']);
	$pdf->SetY($ini_y + $c1_vc);
	$pdf->SetX($ini_x + 165);
	$pdf->Cell(0,0,$row['conyuge1folioinscripcion']);
	$pdf->SetY($ini_y + $c1_vc);
	$pdf->SetX($ini_x + 201);
	$pdf->Cell(0,0,$row['conyuge1partidainscripcion']);
	$pdf->SetY($ini_y + $c1_vc);
	$pdf->SetX($ini_x + 241);
	$pdf->Cell(0,0,$row['conyuge1anyoinscripcion']);
	$c2_vc=331;
	$pdf->SetY($ini_y + $c2_vc);
	$pdf->SetX($ini_x + 50);
	$pdf->Cell(0,0,$row['conyuge2lugarinscripcion']);
	$pdf->SetY($ini_y + $c2_vc);
	$pdf->SetX($ini_x + 130);
	$pdf->Cell(0,0,$row['conyuge2tomoinscripcion']);
	$pdf->SetY($ini_y + $c2_vc);
	$pdf->SetX($ini_x + 165);
	$pdf->Cell(0,0,$row['conyuge2folioinscripcion']);
	$pdf->SetY($ini_y + $c2_vc);
	$pdf->SetX($ini_x + 201);
	$pdf->Cell(0,0,$row['conyuge2partidainscripcion']);
	$pdf->SetY($ini_y + $c2_vc);
	$pdf->SetX($ini_x + 241);
	$pdf->Cell(0,0,$row['conyuge2anyoinscripcion']);
	
 	
}
$pdf->Output();
?>

